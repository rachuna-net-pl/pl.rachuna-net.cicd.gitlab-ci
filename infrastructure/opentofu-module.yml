---
# -----------------------------------------------------------------------------
# GitLab CI configuration for opentofu-module.
# -----------------------------------------------------------------------------
include:
  - local: _common.yml
  ### opentofu
  - component: $CI_SERVER_FQDN/pl.rachuna-net/cicd/components/infrastructure/opentofu@v1.0.0


### validate
ğŸ•µ opentofu fmt:
  needs:
    - job: ğŸ” Input Parameters
    - job: ğŸ” Analyze Conventional Commits
    - job: ğŸ•µ Set Version

âœ… opentofu validate:
  rules:
    - when: never

âœ… tflint:
  needs:
    - job: ğŸ” Input Parameters
    - job: ğŸ” Analyze Conventional Commits
    - job: ğŸ•µ Set Version

âœ… terraform-docs:
  needs:
    - job: ğŸ” Input Parameters
    - job: ğŸ” Analyze Conventional Commits
    - job: ğŸ•µ Set Version

### unit-test
ğŸ§ª opentofu plan:
  rules:
    - when: never

### release
ğŸ“ Publish Version:
  needs:
    - job: ğŸ•µ Set Version
      artifacts: true
    - job: ğŸ•µ YAML lint
      optional: true
    - job: ğŸ•µ opentofu fmt
    - job: âœ… tflint
    - job: âœ… terraform-docs

### deploy
ğŸ’¥ opentofu apply:
  rules:
    - when: never
